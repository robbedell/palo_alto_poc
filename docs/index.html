<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palo Alto Firewall Automation</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to external CSS -->
    <script src="scriptGenerator.js" defer></script> <!-- Link to the new script file -->
    <script>
        function toggleSection(section) {
            section.classList.toggle("collapsed");
        }

        function toggleDarkMode() {
            const body = document.body;
            const toggleButton = document.getElementById('darkModeToggle');
            body.classList.toggle('dark-mode');
            toggleButton.textContent = body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ðŸŒ™';
            localStorage.setItem('darkMode', body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
        }

        function validateField(field, regex, errorMessage) {
            const errorElement = field.nextElementSibling;
            if (!regex.test(field.value.trim())) {
                field.style.borderColor = "red";
                errorElement.textContent = errorMessage;
                errorElement.classList.remove("hidden");
                return false;
            }
            field.style.borderColor = "";
            errorElement.textContent = "";
            errorElement.classList.add("hidden");
            return true;
        }

        function validateInputs() {
            let isValid = true;

            const firewallIpField = document.getElementById("firewallIp");
            const apiKeyField = document.getElementById("apiKey");
            const firewallHostnameField = document.getElementById("firewallHostname");

            isValid &= validateField(firewallIpField, /^\d{1,3}(\.\d{1,3}){3}$/, "Invalid IP address");
            isValid &= validateField(apiKeyField, /^.+$/, "API key is required");
            isValid &= validateField(firewallHostnameField, /^[a-zA-Z0-9_-]+$/, "Invalid hostname");

            document.querySelectorAll(".row").forEach(row => {
                row.querySelectorAll("input").forEach(input => {
                    const regex = input.getAttribute("data-regex");
                    const errorMessage = input.getAttribute("data-error");
                    if (regex && errorMessage) {
                        isValid &= validateField(input, new RegExp(regex), errorMessage);
                    }
                });
            });

            return isValid;
        }

        function addCustomRow(containerId, fields) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container with ID "${containerId}" not found.`);
                return;
            }

            const row = document.createElement("div");
            row.className = "row";

            fields.forEach(field => {
                let inputElement;
                if (field.type === "select") {
                    inputElement = document.createElement("select");
                    inputElement.className = field.className;
                    field.options.forEach(option => {
                        const optionElement = document.createElement("option");
                        optionElement.value = option.value;
                        optionElement.textContent = option.label;
                        inputElement.appendChild(optionElement);
                    });
                } else {
                    inputElement = document.createElement("input");
                    inputElement.type = "text";
                    inputElement.placeholder = field.placeholder;
                    inputElement.className = field.className;
                    if (field.regex) {
                        inputElement.setAttribute("data-regex", field.regex.source);
                    }
                    if (field.errorMessage) {
                        inputElement.setAttribute("data-error", field.errorMessage);
                    }
                }

                row.appendChild(inputElement);
            });

            const deleteButton = document.createElement("button");
            deleteButton.type = "button";
            deleteButton.textContent = "Remove";
            deleteButton.onclick = () => container.removeChild(row);
            row.appendChild(deleteButton);

            container.appendChild(row);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const config = JSON.parse(e.target.result);
                    updateCodeBlocks(config);
                    updateConfigForGeneration(config); // Update the config for script generation
                    alert("Configuration loaded successfully!");
                } catch (error) {
                    alert("Invalid JSON file. Please upload a valid configuration.");
                }
            };
            reader.readAsText(file);
        }

        function updateConfigForGeneration(config) {
            // Update the form fields with the uploaded JSON configuration
            if (config.firewall) {
                document.getElementById("firewallIp").value = config.firewall.management_ip || "";
                document.getElementById("apiKey").value = config.firewall.api_key || "";
                document.getElementById("firewallHostname").value = config.firewall.hostname || "";
            }

            // Update custom rows for interfaces, address objects, service objects, etc.
            const updateCustomRows = (containerId, data, fields) => {
                const container = document.getElementById(containerId);
                container.innerHTML = ""; // Clear existing rows
                data.forEach(item => addCustomRow(containerId, fields.map(field => ({
                    ...field,
                    value: item[field.className] || ""
                }))));
            };

            if (config.interfaces) {
                updateCustomRows("customIpContainer", config.interfaces, [
                    { type: "select", className: "interface-name", options: [
                        { value: "ethernet1/1", label: "ethernet1/1" },
                        { value: "ethernet1/2", label: "ethernet1/2" },
                        { value: "ethernet1/3", label: "ethernet1/3" },
                        { value: "ethernet1/4", label: "ethernet1/4" }
                    ] },
                    { placeholder: "IP Address (e.g., 192.168.10.1)", className: "ip-address" },
                    { placeholder: "Subnet Mask (e.g., 24)", className: "subnet-mask" }
                ]);
            }

            if (config.address_objects) {
                updateCustomRows("customAddressContainer", config.address_objects, [
                    { placeholder: "Address Name (e.g., web_server)", className: "address-name" },
                    { placeholder: "IP Address (e.g., 192.168.30.10)", className: "address-ip" },
                    { placeholder: "Description (e.g., Web Server)", className: "address-description" }
                ]);
            }

            if (config.service_objects) {
                updateCustomRows("customServiceContainer", config.service_objects, [
                    { placeholder: "Service Name (e.g., http)", className: "service-name" },
                    { placeholder: "Protocol (e.g., tcp)", className: "service-protocol" },
                    { placeholder: "Port (e.g., 80)", className: "service-port" },
                    { placeholder: "Description (e.g., HTTP Service)", className: "service-description" }
                ]);
            }

            if (config.virtual_routers) {
                updateCustomRows("customRouterContainer", config.virtual_routers.map(name => ({ "router-name": name })), [
                    { placeholder: "Router Name (e.g., trust)", className: "router-name" }
                ]);
            }

            if (config.security_rules) {
                updateCustomRows("customSecurityContainer", config.security_rules, [
                    { placeholder: "Rule Name (e.g., Allow_HTTP)", className: "rule-name" },
                    { placeholder: "From Zone (e.g., trust)", className: "from-zone" },
                    { placeholder: "To Zone (e.g., untrust)", className: "to-zone" },
                    { placeholder: "Source (e.g., any)", className: "source" },
                    { placeholder: "Destination (e.g., any)", className: "destination" },
                    { placeholder: "Application (e.g., any)", className: "application" },
                    { placeholder: "Service (e.g., any)", className: "service" },
                    { placeholder: "Action (e.g., allow)", className: "action", regex: /^(allow|deny)$/, errorMessage: 'Invalid action', required: true },
                    { placeholder: "Tag (e.g., POC-DELETE)", className: "tag" }
                ]);
            }
        }

        function updateCodeBlocks(config) {
            if (config.firewall) {
                document.querySelector("#firewallConfig details pre code").textContent = `
provider:
  ip_address: "${config.firewall.management_ip}"
  api_key: "${config.firewall.api_key}"
hostname: "${config.firewall.hostname}"
                `.trim();
            }

            if (config.interfaces) {
                document.querySelector("#interfaceConfig details pre code").textContent = `
interfaces:
${config.interfaces.map(i => `  - name: "${i.name}"\n    ip: ${i.ip ? `"${i.ip}"` : "null"}\n    dhcp: ${i.dhcp}`).join("\n")}
                `.trim();
            }

            if (config.address_objects) {
                document.querySelector("#addressConfig details pre code").textContent = `
address_objects:
${config.address_objects.map(a => `  - name: "${a.name}"\n    ip: "${a.ip}"\n    description: "${a.description}"`).join("\n")}
                `.trim();
            }

            if (config.service_objects) {
                document.querySelector("#serviceConfig details pre code").textContent = `
service_objects:
${config.service_objects.map(s => `  - name: "${s.name}"\n    protocol: "${s.protocol}"\n    port: "${s.port}"\n    description: "${s.description}"`).join("\n")}
                `.trim();
            }

            if (config.virtual_routers) {
                document.querySelector("#routerConfig details pre code").textContent = `
virtual_routers:
${config.virtual_routers.map(vr => `  - "${vr}"`).join("\n")}
                `.trim();
            }

            if (config.security_rules) {
                document.querySelector("#securityConfig details pre code").textContent = `
security_rules:
${config.security_rules.map(r => `
  - name: "${r.name}"
    from_zone: ${JSON.stringify(r.from_zone)}
    to_zone: ${JSON.stringify(r.to_zone)}
    source: ${JSON.stringify(r.source)}
    destination: ${JSON.stringify(r.destination)}
    application: ${JSON.stringify(r.application)}
    service: ${JSON.stringify(r.service)}
    action: "${r.action}"
    tag: ${JSON.stringify(r.tag)}
`).join("\n")}
                `.trim();
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            // Set dark mode based on OS preference or saved user preference
            const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedDarkMode = localStorage.getItem('darkMode');
            const body = document.body;

            if (savedDarkMode === 'enabled' || (savedDarkMode === null && prefersDarkMode)) {
                body.classList.add('dark-mode');
            }

            const darkModeToggle = document.createElement('button');
            darkModeToggle.id = 'darkModeToggle';
            darkModeToggle.className = 'dark-mode-toggle';
            darkModeToggle.textContent = body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ðŸŒ™';
            darkModeToggle.onclick = toggleDarkMode;
            document.body.appendChild(darkModeToggle);

            document.querySelectorAll(".form-section h2").forEach(header => {
                header.addEventListener("click", () => toggleSection(header.parentElement));
            });

            const uploadInput = document.createElement("input");
            uploadInput.type = "file";
            uploadInput.accept = "application/json";
            uploadInput.style.marginBottom = "1rem";
            uploadInput.addEventListener("change", handleFileUpload);

            const sidebar = document.querySelector(".sidebar");
            const uploadLabel = document.createElement("label");
            uploadLabel.textContent = "Upload Configuration:";
            uploadLabel.style.color = "white";
            sidebar.appendChild(uploadLabel);
            sidebar.appendChild(uploadInput);
        });
    </script>
</head>
<body>
    <header>
        <h1>Palo Alto Firewall Automation</h1>
    </header>
    <div class="container">
        <aside class="sidebar">
            <h2>Navigation</h2>
            <button onclick="document.getElementById('firewallConfig').scrollIntoView()">Firewall Configuration</button>
            <button onclick="document.getElementById('interfaceConfig').scrollIntoView()">Interface Configuration</button>
            <button onclick="document.getElementById('addressConfig').scrollIntoView()">Address Objects</button>
            <button onclick="document.getElementById('serviceConfig').scrollIntoView()">Service Objects</button>
            <button onclick="document.getElementById('routerConfig').scrollIntoView()">Virtual Routers</button>
            <button onclick="document.getElementById('securityConfig').scrollIntoView()">Security Rules</button>
            <button id="generateScriptsButton" style="background-color: red; color: white; margin-top: 1rem;" onclick="generateAndDownloadScripts()">Generate Scripts</button>
        </aside>
        <main class="main-content">
            <section id="firewallConfig" class="form-section">
                <h2>Firewall Configuration</h2>
                <details>
                    <summary>Default Configuration</summary>
                    <pre><code class="language-yaml">
provider:
  ip_address: "192.168.1.1"  # Default management IP
  api_key: "YOUR_API_KEY"    # Replace with your valid API key
hostname: "PANFW01"          # Default hostname
                    </code></pre>
                </details>
                <div class="form-content"></div>
                    <label for="firewallIp">Firewall Management IP:</label>
                    <div class="explanation">Enter the management IP address of your Palo Alto Firewall. Example: <code>192.168.1.1</code>.</div>
                    <input type="text" id="firewallIp" placeholder="192.168.1.1" value="192.168.1.1" required>
                    <div class="error hidden"></div>

                    <label for="apiKey">API Key:</label>
                    <div class="explanation">Enter the API key generated from your Palo Alto Firewall. This is required for authentication. Example: <code>ABCD1234EFGH5678</code>.</div>
                    <input type="text" id="apiKey" placeholder="Enter your API key" value="YOUR_API_KEY" required>
                    <div class="error hidden"></div>

                    <label for="firewallHostname">Firewall Hostname:</label>
                    <div class="explanation">Enter the hostname for your Palo Alto Firewall. Default: <code>PANFW01</code>. Example: <code>MyFirewall</code>.</div>
                    <input type="text" id="firewallHostname" placeholder="PANFW01" value="PANFW01">
                    <div class="error hidden"></div>
                </div>
            </section>

            <section id="interfaceConfig" class="form-section collapsed">
                <h2>Custom Interface Configuration</h2>
                <details>
                    <summary>Default Configuration</summary>
                    <pre><code class="language-yaml">
interfaces:
  - name: "ethernet1/1"
    ip: null
    dhcp: true
  - name: "ethernet1/2"
    ip: null
    dhcp: true
  - name: "ethernet1/3"
    ip: null
    dhcp: true
  - name: "ethernet1/4"
    ip: null
    dhcp: true
                    </code></pre>
                </details>
                <div class="form-content"></div>
                    <div class="explanation">Add custom interfaces by selecting the interface name, and optionally specifying the IP address and subnet mask. Defaults to DHCP if no custom values are provided.</div>
                    <div id="customIpContainer"></div>
                    <button type="button" onclick="addCustomRow('customIpContainer', [
                        { type: 'select', className: 'interface-name', options: [
                            { value: 'ethernet1/1', label: 'ethernet1/1' },
                            { value: 'ethernet1/2', label: 'ethernet1/2' },
                            { value: 'ethernet1/3', label: 'ethernet1/3' },
                            { value: 'ethernet1/4', label: 'ethernet1/4' }
                        ], required: true },
                        { placeholder: 'IP Address (e.g., 192.168.10.1)', className: 'ip-address', regex: /^\d{1,3}(\.\d{1,3}){3}$/, errorMessage: 'Invalid IP address' },
                        { placeholder: 'Subnet Mask (e.g., 24)', className: 'subnet-mask', regex: /^\d{1,2}$/, errorMessage: 'Invalid subnet mask' }
                    ])">Add Interface</button>
                </div>
            </section>

            <section id="addressConfig" class="form-section collapsed">
                <h2>Custom Address Objects</h2>
                <details>
                    <summary>Default Configuration</summary>
                    <pre><code class="language-yaml">
address_objects:
  - name: "web_server"
    ip: "192.168.30.10"
    description: "Web Server Address"
  - name: "db_server"
    ip: "192.168.40.10"
    description: "Database Server Address"
                    </code></pre>
                </details>
                <div class="form-content">
                    <div class="explanation">Add custom address objects by specifying the name, IP address, and description.</div>
                    <div id="customAddressContainer"></div>
                    <button type="button" onclick="addCustomRow('customAddressContainer', [
                        { placeholder: 'Address Name (e.g., web_server)', className: 'address-name', regex: /^[a-zA-Z0-9_]+$/, errorMessage: 'Invalid name', required: true },
                        { placeholder: 'IP Address (e.g., 192.168.30.10)', className: 'address-ip', regex: /^\d{1,3}(\.\d{1,3}){3}$/, errorMessage: 'Invalid IP address', required: true },
                        { placeholder: 'Description (e.g., Web Server)', className: 'address-description', regex: /^.*$/, errorMessage: '' }
                    ])">Add Address</button>
                </div>
            </section>

            <section id="serviceConfig" class="form-section collapsed">
                <h2>Custom Service Objects</h2>
                <details>
                    <summary>Default Configuration</summary>
                    <pre><code class="language-yaml">
service_objects:
  - name: "http"
    protocol: "tcp"
    port: "80"
    description: "HTTP Service"
  - name: "https"
    protocol: "tcp"
    port: "443"
    description: "HTTPS Service"
                    </code></pre>
                </details>
                <div class="form-content">
                    <div class="explanation">Add custom service objects by specifying the name, protocol, port, and description.</div>
                    <div id="customServiceContainer"></div>
                    <button type="button" onclick="addCustomRow('customServiceContainer', [
                        { placeholder: 'Service Name (e.g., http)', className: 'service-name', regex: /^[a-zA-Z0-9_]+$/, errorMessage: 'Invalid name', required: true },
                        { placeholder: 'Protocol (e.g., tcp)', className: 'service-protocol', regex: /^(tcp|udp)$/, errorMessage: 'Invalid protocol', required: true },
                        { placeholder: 'Port (e.g., 80)', className: 'service-port', regex: /^\d+$/, errorMessage: 'Invalid port', required: true },
                        { placeholder: 'Description (e.g., HTTP Service)', className: 'service-description', regex: /^.*$/, errorMessage: '' }
                    ])">Add Service</button>
                </div>
            </section>

            <section id="routerConfig" class="form-section collapsed">
                <h2>Custom Virtual Routers</h2>
                <details>
                    <summary>Default Configuration</summary>
                    <pre><code class="language-yaml">
virtual_routers:
  - "trust"
  - "untrust"
  - "vpn"
  - "webtier"
                    </code></pre>
                </details>
                <div class="form-content">
                    <div class="explanation">Add custom virtual routers by specifying their names. Example: <code>trust</code>, <code>untrust</code>.</div>
                    <div id="customRouterContainer"></div>
                    <button type="button" onclick="addCustomRow('customRouterContainer', [
                        { placeholder: 'Router Name (e.g., trust)', className: 'router-name', regex: /^[a-zA-Z0-9_]+$/, errorMessage: 'Invalid name', required: true }
                    ])">Add Router</button>
                </div>
            </section>

            <section id="securityConfig" class="form-section collapsed">
                <h2>Custom Security Rules</h2>
                <details>
                    <summary>Default Configuration</summary>
                    <pre><code class="language-yaml">
security_rules:
  - name: "POC_Any_Any_premigrate"
    from_zone: ["any"]
    to_zone: ["any"]
    source: ["any"]
    destination: ["any"]
    application: ["any"]
    service: ["any"]
    action: "allow"
    tag: ["POC-DELETE"]
                    </code></pre>
                </details>
                <div class="form-content">
                    <div class="explanation">Add custom security rules by specifying their details. Example: Rule Name: <code>Allow_HTTP</code>, From Zone: <code>trust</code>, To Zone: <code>untrust</code>.</div>
                    <div id="customSecurityContainer"></div>
                    <button type="button" onclick="addCustomRow('customSecurityContainer', [
                        { placeholder: 'Rule Name (e.g., Allow_HTTP)', className: 'rule-name', regex: /^[a-zA-Z0-9_]+$/, errorMessage: 'Invalid name', required: true },
                        { placeholder: 'From Zone (e.g., trust)', className: 'from-zone', regex: /^.*$/, errorMessage: '' },
                        { placeholder: 'To Zone (e.g., untrust)', className: 'to-zone', regex: /^.*$/, errorMessage: '' },
                        { placeholder: 'Source (e.g., any)', className: 'source', regex: /^.*$/, errorMessage: '' },
                        { placeholder: 'Destination (e.g., any)', className: 'destination', regex: /^.*$/, errorMessage: '' },
                        { placeholder: 'Application (e.g., any)', className: 'application', regex: /^.*$/, errorMessage: '' },
                        { placeholder: 'Service (e.g., any)', className: 'service', regex: /^.*$/, errorMessage: '' },
                        { placeholder: 'Action (e.g., allow)', className: 'action', regex: /^(allow|deny)$/, errorMessage: 'Invalid action', required: true },
                        { placeholder: 'Tag (e.g., POC-DELETE)', className: 'tag', regex: /^.*$/, errorMessage: '' }
                    ])">Add Rule</button>
                </div>
            </section>
        </main>
    </div>
</body>
</html>