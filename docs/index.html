<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palo Alto Firewall Automation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: #000000;
        }
        header {
            background-color: #0078d7;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        main {
            padding: 2rem;
            max-width: 800px;
            margin: auto;
        }
        label {
            font-weight: bold;
        }
        select, input, button {
            margin: 0.5rem 0;
            padding: 0.5rem;
            width: 100%;
            max-width: 600px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #0078d7;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #005bb5;
        }
        .row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        .row select, .row input {
            flex: 1;
        }
        .row button {
            padding: 0.3rem 0.5rem;
            font-size: 0.8rem;
            width: auto;
        }
        .error {
            color: red;
            font-size: 0.9rem;
        }
        .explanation {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 0.5rem;
        }
    </style>
    <script>
        let includeDefaults = true;

        function validateInput(input, regex, errorMessage) {
            const errorElement = input.nextElementSibling;
            if (!regex.test(input.value)) {
                errorElement.textContent = errorMessage;
                return false;
            }
            errorElement.textContent = '';
            return true;
        }

        function addCustomRow(containerId, fields) {
            const container = document.getElementById(containerId);
            const row = document.createElement("div");
            row.className = "row";
            fields.forEach(field => {
                let input;
                if (field.type === "select") {
                    input = document.createElement("select");
                    field.options.forEach(option => {
                        const opt = document.createElement("option");
                        opt.value = option.value;
                        opt.textContent = option.label;
                        input.appendChild(opt);
                    });
                } else {
                    input = document.createElement("input");
                    input.type = "text";
                    input.placeholder = field.placeholder;
                }
                input.className = field.className;
                input.required = field.required || false;
                input.oninput = () => validateInput(input, field.regex, field.errorMessage);
                row.appendChild(input);

                const error = document.createElement("div");
                error.className = "error";
                row.appendChild(error);
            });
            const removeButton = document.createElement("button");
            removeButton.type = "button";
            removeButton.textContent = "X";
            removeButton.onclick = () => row.remove();
            row.appendChild(removeButton);
            container.appendChild(row);
        }

        function removeAllDefaults() {
            includeDefaults = false;
            document.getElementById("customIpContainer").innerHTML = "";
            document.getElementById("customAddressContainer").innerHTML = "";
            document.getElementById("customServiceContainer").innerHTML = "";
            alert("Default configuration removed. Only custom values will be included in the scripts.");
        }

        async function fetchDefaultScripts() {
            try {
                const pythonResponse = await fetch('./east-fw-config.py');
                const terraformResponse = await fetch('./palo_alto_firewall.tf');
                const ansibleResponse = await fetch('./ansible_playbook.yml');

                if (!pythonResponse.ok || !terraformResponse.ok || !ansibleResponse.ok) {
                    throw new Error("Failed to fetch default scripts.");
                }

                const pythonScript = await pythonResponse.text();
                const terraformScript = await terraformResponse.text();
                const ansibleScript = await ansibleResponse.text();

                return { pythonScript, terraformScript, ansibleScript };
            } catch (error) {
                alert("Error fetching default scripts: " + error.message);
                throw error;
            }
        }

        async function generateScripts() {
            try {
                const { pythonScript, terraformScript, ansibleScript } = await fetchDefaultScripts();

                const firewallIp = document.getElementById("firewallIp").value;
                const apiKey = document.getElementById("apiKey").value;
                const firewallHostname = document.getElementById("firewallHostname").value || "PANFW01";

                const customIps = [];
                document.querySelectorAll("#customIpContainer .row").forEach(row => {
                    const interfaceName = row.querySelector(".interface-name").value;
                    const ip = row.querySelector(".ip-address").value;
                    const subnet = row.querySelector(".subnet-mask").value;
                    if (interfaceName) {
                        customIps.push({ interfaceName, ip, subnet });
                    }
                });

                const customAddresses = [];
                document.querySelectorAll("#customAddressContainer .row").forEach(row => {
                    const name = row.querySelector(".address-name").value;
                    const ip = row.querySelector(".address-ip").value;
                    const description = row.querySelector(".address-description").value;
                    if (name) {
                        customAddresses.push({ name, ip, description });
                    }
                });

                const customServices = [];
                document.querySelectorAll("#customServiceContainer .row").forEach(row => {
                    const name = row.querySelector(".service-name").value;
                    const protocol = row.querySelector(".service-protocol").value;
                    const port = row.querySelector(".service-port").value;
                    const description = row.querySelector(".service-description").value;
                    if (name) {
                        customServices.push({ name, protocol, port, description });
                    }
                });

                const defaultIps = [
                    { interfaceName: "ethernet1/1", ip: null, subnet: null },
                    { interfaceName: "ethernet1/2", ip: null, subnet: null },
                    { interfaceName: "ethernet1/3", ip: null, subnet: null },
                    { interfaceName: "ethernet1/4", ip: null, subnet: null }
                ];

                const defaultAddresses = [
                    { name: "web_server", ip: "192.168.30.10", description: "Web Server Address" },
                    { name: "db_server", ip: "192.168.40.10", description: "Database Server Address" }
                ];

                const defaultServices = [
                    { name: "http", protocol: "tcp", port: "80", description: "HTTP Service" },
                    { name: "https", protocol: "tcp", port: "443", description: "HTTPS Service" }
                ];

                const ips = includeDefaults ? [...defaultIps, ...customIps] : customIps;
                const addresses = includeDefaults ? [...defaultAddresses, ...customAddresses] : customAddresses;
                const services = includeDefaults ? [...defaultServices, ...customServices] : customServices;

                const updatedPythonScript = pythonScript
                    .replace(/firewall_ip = .*/, `firewall_ip = '${firewallIp}'`)
                    .replace(/api_key = .*/, `api_key = '${apiKey}'`)
                    .replace(/firewall_hostname = .*/, `firewall_hostname = '${firewallHostname}'`)
                    .replace(/custom_ips = .*/, `custom_ips = ${JSON.stringify(ips, null, 4)}`)
                    .replace(/custom_addresses = .*/, `custom_addresses = ${JSON.stringify(addresses, null, 4)}`)
                    .replace(/custom_services = .*/, `custom_services = ${JSON.stringify(services, null, 4)}`);

                const updatedTerraformScript = terraformScript
                    .replace(/hostname = .*/, `hostname = "${firewallIp}"`)
                    .replace(/api_key  = .*/, `api_key  = "${apiKey}"`);

                const updatedAnsibleScript = ansibleScript
                    .replace(/ip_address: .*/, `ip_address: "${firewallIp}"`)
                    .replace(/api_key: .*/, `api_key: "${apiKey}"`);

                downloadFile("east-fw-config.py", updatedPythonScript);
                downloadFile("palo_alto_firewall.tf", updatedTerraformScript);
                downloadFile("ansible_playbook.yml", updatedAnsibleScript);

                alert("Scripts generated and downloaded successfully!");
            } catch (error) {
                console.error("Error generating scripts:", error);
            }
        }

        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: "text/plain" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</head>
<body>
    <header>
        <h1>Palo Alto Firewall Automation</h1>
    </header>
    <main>
        <div class="container">
            <div class="form-section">
                <p>Use this tool to generate Python, Terraform, and Ansible scripts for automating Palo Alto Firewall configurations. Fill in the required fields below and click "Generate Scripts".</p>
                
                <form onsubmit="event.preventDefault(); generateScripts();">
                    <label for="firewallIp">Firewall Management IP:</label>
                    <div class="explanation">Enter the management IP address of your Palo Alto Firewall. Default: <code>192.168.1.1</code>.</div>
                    <input type="text" id="firewallIp" placeholder="192.168.1.1" value="192.168.1.1" required>
                    <div class="error"></div>

                    <label for="apiKey">API Key:</label>
                    <div class="explanation">Enter the API key generated from your Palo Alto Firewall. This is required for authentication.</div>
                    <input type="text" id="apiKey" placeholder="Enter your API key" required>
                    <div class="error"></div>

                    <label for="firewallHostname">Firewall Hostname:</label>
                    <div class="explanation">Enter the hostname for your Palo Alto Firewall. Default: <code>PANFW01</code>.</div>
                    <input type="text" id="firewallHostname" placeholder="PANFW01">
                    <div class="error"></div>

                    <h3>Custom Interface Configuration</h3>
                    <div class="explanation">Add custom interfaces by selecting the interface name, and optionally specifying the IP address and subnet mask.</div>
                    <div id="customIpContainer"></div>
                    <button type="button" onclick="addCustomRow('customIpContainer', [
                        { type: 'select', className: 'interface-name', options: [
                            { value: 'ethernet1/1', label: 'ethernet1/1' },
                            { value: 'ethernet1/2', label: 'ethernet1/2' },
                            { value: 'ethernet1/3', label: 'ethernet1/3' },
                            { value: 'ethernet1/4', label: 'ethernet1/4' }
                        ], required: true },
                        { placeholder: 'IP Address (e.g., 192.168.10.1)', className: 'ip-address', regex: /^\d{1,3}(\.\d{1,3}){3}$/, errorMessage: 'Invalid IP address' },
                        { placeholder: 'Subnet Mask (e.g., 24)', className: 'subnet-mask', regex: /^\d{1,2}$/, errorMessage: 'Invalid subnet mask' }
                    ])">Add Interface</button>

                    <h3>Custom Address Objects</h3>
                    <div class="explanation">Add custom address objects by specifying the name, IP address, and description.</div>
                    <div id="customAddressContainer"></div>
                    <button type="button" onclick="addCustomRow('customAddressContainer', [
                        { placeholder: 'Address Name (e.g., web_server)', className: 'address-name', regex: /^[a-zA-Z0-9_]+$/, errorMessage: 'Invalid name', required: true },
                        { placeholder: 'IP Address (e.g., 192.168.30.10)', className: 'address-ip', regex: /^\d{1,3}(\.\d{1,3}){3}$/, errorMessage: 'Invalid IP address', required: true },
                        { placeholder: 'Description (e.g., Web Server)', className: 'address-description', regex: /^.*$/, errorMessage: '' }
                    ])">Add Address</button>

                    <h3>Custom Service Objects</h3>
                    <div class="explanation">Add custom service objects by specifying the name, protocol, port, and description.</div>
                    <div id="customServiceContainer"></div>
                    <button type="button" onclick="addCustomRow('customServiceContainer', [
                        { placeholder: 'Service Name (e.g., http)', className: 'service-name', regex: /^[a-zA-Z0-9_]+$/, errorMessage: 'Invalid name', required: true },
                        { placeholder: 'Protocol (e.g., tcp)', className: 'service-protocol', regex: /^(tcp|udp)$/, errorMessage: 'Invalid protocol', required: true },
                        { placeholder: 'Port (e.g., 80)', className: 'service-port', regex: /^\d+$/, errorMessage: 'Invalid port', required: true },
                        { placeholder: 'Description (e.g., HTTP Service)', className: 'service-description', regex: /^.*$/, errorMessage: '' }
                    ])">Add Service</button>

                    <button type="button" class="remove-defaults" onclick="removeAllDefaults()">Remove All Defaults</button>
                    <button type="submit">Generate Scripts</button>
                </form>
            </div>
        </div>
    </main>
</body>
</html>